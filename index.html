<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>WFH/WFO Slot Calculator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background: #f4f7fa;
      margin: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 1080px;
      margin: 40px auto;
      background: #fff;
      padding: 30px 24px;
      border-radius: 14px;
      box-shadow: 0 4px 32px rgba(60,60,60,0.09);
    }
    h2 {
      margin: 0 0 18px 0;
      font-weight: 700;
      font-size: 1.55rem;
      color: #1a202c;
    }
    .desc {
      color: #555;
      margin-bottom: 20px;
      font-size: 1.04rem;
    }
    .table-responsive {
      overflow-x: auto;
    }
    table {
      border-collapse: separate;
      border-spacing: 0;
      width: 100%;
      background: #fff;
      margin-bottom: 12px;
      font-size:1rem;
    }
    th, td {
      padding: 9px 7px;
      border-bottom: 1px solid #e1e7ee;
      text-align: center;
    }
    /* Header color sections */
    th.section-wfo     { background: #E2E6FA; color: #25356B; }
    th.section-slot1   { background: #D0F0D6; color: #195B3E; }
    th.section-slot2   { background: #FFEAC9; color: #A76107; }
    th.section-total   { background: #FFE0E0; color: #9A2535;}
    th.section-delete  { background: #fafafa;}
    /* Column dividers */
    td, th { border-right: 1.5px solid #fff; }
    td.section-div, th.section-div {
      border-right: 2.5px solid #a3adc7 !important;
      background: #f3f6fa;
      padding-left:0; padding-right:0;
      width: 3px;
    }
    tr:last-child td { border-bottom: none;}
    /* Narrow input width */
    input[type="text"] {
      width: 78px;
      padding: 6px 5px;
      border: 1px solid #bccbf3;
      border-radius: 5px;
      font-size: 1rem;
      background: #f9faff;
      box-sizing: border-box;
      text-align: center;
    }
    input[type="text"]:focus {
      outline: 2px solid #396bdb;
      background: #ddeafd;
    }
    th { font-weight: 600;}
    .actions {
      margin: 12px 0 18px;
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
    }
    .btn {
      font-size: 1rem;
      padding: 7px 18px;
      border: none;
      border-radius: 5px;
      background: #396bdb;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: background 0.15s;
    }
    .btn:active {
      background: #274085;
    }
    .btn.secondary {
      background: #a9adc1;
      color: #fff;
    }
    @media (max-width: 1000px) {
      .container { padding: 10px 1px;}
      th, td { font-size: 0.93rem;}
      input[type="text"]{width:62px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Work From Home Slot Calculator</h2>
    <div class="desc">
      Paste your <b>WFO data (Date, WFO In, WFO Out)</b> from Excel or Sheets.<br>
      The table will <b>auto-calculate WFH slots</b> as per rules:<br>
      <ul>
        <li>Work starts at <b>08:00</b></li>
        <li>Min. total working hours: <b>9:16</b> (including WFO & WFH)<br>
        <li>Commute: <b>30 min</b> before and after office</li>
        <li>All times in 24hr format <b>(hh:mm)</b></li>
      </ul>
    </div>
    <div class="actions">
      <button class="btn" onclick="addRow()">Add Row</button>
      <button class="btn secondary" onclick="clearTable()">Clear All</button>
      <button class="btn secondary" onclick="pasteFromClipboard()">Paste (Date, WFO In, WFO Out)</button>
    </div>
    <div class="table-responsive">
      <table id="calc-table">
        <colgroup>
          <col span="1"><col span="2">
          <col class="section-div"><!-- WFO/S1 divider -->
          <col span="3">
          <col class="section-div"><!-- S1/S2 divider -->
          <col span="3">
          <col class="section-div"><!-- S2/Total divider -->
          <col span="1">
          <col span="1">
        </colgroup>
        <thead>
          <tr>
            <th class="section-wfo">Date</th>
            <th class="section-wfo">WFO In</th>
            <th class="section-wfo">WFO Out</th>
            <th class="section-div"></th>
            <th class="section-slot1">Slot 1 - WFH In</th>
            <th class="section-slot1">Slot 1 - WFH Out</th>
            <th class="section-slot1">Slot 1 Duration</th>
            <th class="section-div"></th>
            <th class="section-slot2">Slot 2 - WFH In</th>
            <th class="section-slot2">Slot 2 - WFH Out</th>
            <th class="section-slot2">Slot 2 Duration</th>
            <th class="section-div"></th>
            <th class="section-total">Total Hours</th>
            <th class="section-delete"></th>
          </tr>
        </thead>
        <tbody id="table-body">
        </tbody>
      </table>
    </div>
  </div>
<script>
function parseTimeHHMM(str) {
  // "09:30" => minutes since 00:00
  if (!/^([01]?\d|2[0-3]):[0-5]\d$/.test(str.trim())) return null;
  let [h, m] = str.split(":").map(Number);
  return h*60+m;
}
function minsToHHMM(mins) {
  let h = Math.floor(mins/60);
  let m = mins%60;
  return (h<10?'0':'')+h + ":" + (m<10?'0':'')+m;
}
function durationHHMM(mins) {
  if (mins == null) return "";
  let neg = mins<0;
  mins = Math.abs(mins);
  let h = Math.floor(mins/60);
  let m = mins%60;
  return (neg?'-':'') + (h<10?'0':'')+h + ":" + (m<10?'0':'')+m;
}
function validTime(str) { return parseTimeHHMM(str) != null; }
const START_OF_DAY = 8*60;
const DAY_WORK_MINUTES = 9*60+16;
const COMMUTE = 30;
function emptyRow(){ return {date: "",wfoIn: "",wfoOut: ""}; }
function calcForRow(row) {
  let out = {
    wfoDuration: "",
    slot1In: "",
    slot1Out: "",
    slot1Duration: "",
    slot2In: "",
    slot2Out: "",
    slot2Duration: "",
    totalHours: ""
  };
  let wfoIn = parseTimeHHMM(row.wfoIn);
  let wfoOut = parseTimeHHMM(row.wfoOut);
  let workStart = START_OF_DAY;
  if (!validTime(row.wfoIn) || !validTime(row.wfoOut) || wfoOut<=wfoIn) return out;
  let wfoDuration = wfoOut - wfoIn;
  out.wfoDuration = durationHHMM(wfoDuration);

  // Commute
  let leaveForOffice = wfoIn - COMMUTE; //Leave home
  let reachHome = wfoOut + COMMUTE; //Back home

  // Slot 1: Before office
  let slot1In = workStart;
  let slot1Out = wfoIn - COMMUTE;
  let slot1Duration = slot1Out > slot1In ? slot1Out - slot1In : 0;

  // Total hours so far
  let hoursWorkedSoFar = slot1Duration + wfoDuration;

  // If slot1+WFO covers day, slot2 not needed.
  if (hoursWorkedSoFar >= DAY_WORK_MINUTES) {
    if (slot1Duration >= DAY_WORK_MINUTES) {
      slot1Duration = DAY_WORK_MINUTES;
      slot1Out = slot1In + DAY_WORK_MINUTES;
      out.slot1In = minsToHHMM(slot1In);
      out.slot1Out = minsToHHMM(slot1Out);
      out.slot1Duration = durationHHMM(slot1Duration);
      out.slot2In = out.slot2Out = out.slot2Duration = "";
      out.totalHours = durationHHMM(slot1Duration);
      return out;
    } else {
      out.slot1In = minsToHHMM(slot1In);
      out.slot1Out = minsToHHMM(slot1Out);
      out.slot1Duration = durationHHMM(slot1Duration);
      out.slot2In = out.slot2Out = out.slot2Duration = "";
      out.totalHours = durationHHMM(wfoDuration+slot1Duration);
      return out;
    }
  }
  let slot2Needed = DAY_WORK_MINUTES - hoursWorkedSoFar;
  let slot2In = wfoOut + COMMUTE;
  let slot2Out = slot2In + slot2Needed;

  out.slot1In = minsToHHMM(slot1In);
  out.slot1Out = minsToHHMM(slot1Out);
  out.slot1Duration = durationHHMM(slot1Duration);

  if (slot2Needed > 0) {
    out.slot2In = minsToHHMM(slot2In);
    out.slot2Out = minsToHHMM(slot2Out);
    out.slot2Duration = durationHHMM(slot2Needed);
  } else {
    out.slot2In = out.slot2Out = out.slot2Duration = "";
  }
  out.totalHours = durationHHMM(
    wfoDuration + slot1Duration + (slot2Needed>0 ? slot2Needed : 0)
  );
  return out;
}
let rows = [];
function formatHHMM(val) {
  let s = val.replace(/[^0-9]/g,'');
  if (s.length>4) s = s.slice(0,4);
  if (s.length>=3) return s.slice(0,2) + ':' + s.slice(2);
  if (s.length>=1 && s.length<=2) return s;
  return '';
}
function handleTimeInput(event, idx, field) {
  let val = event.target.value;
  if (event.inputType === "deleteContentBackward" && val.endsWith(':')) {
    // allow user to delete ':'
    updateCell(idx, field, val.slice(0,-1));
    return;
  }
  let formatted = formatHHMM(val);
  if (formatted !== val) {
    event.target.value = formatted;
  }
  updateCell(idx, field, formatted);
}
function handleTimeBlur(event, idx, field) {
  // On leaving the field, auto-pad if possible
  let val = event.target.value.replace(/[^0-9]/g,'');
  if (val.length===3) val = '0'+val; // 945 -> 0945
  if (val.length===4) {
    let h = val.slice(0,2), m = val.slice(2);
    if (Number(h)<=23 && Number(m)<=59)
      updateCell(idx, field, h+':'+m);
    else
      updateCell(idx, field, '');
  }
}
function renderTable() {
  let tb = document.getElementById("table-body");
  tb.innerHTML = "";
  rows.forEach((row, idx) => {
    let c = calcForRow(row);

    tb.innerHTML += `<tr>
      <td><input type="text" value="${row.date}" onchange="updateCell(${idx},'date',this.value)" style="width:102px"></td>
      <td>
        <input type="text"
          maxlength="5"
          value="${row.wfoIn}"
          inputmode="numeric"
          pattern="^\\d{1,2}:?\\d{0,2}$"
          oninput="handleTimeInput(event,${idx},'wfoIn')"
          onblur="handleTimeBlur(event,${idx},'wfoIn')"
          placeholder="hh:mm">
      </td>
      <td>
        <input type="text"
          maxlength="5"
          value="${row.wfoOut}"
          inputmode="numeric"
          pattern="^\\d{1,2}:?\\d{0,2}$"
          oninput="handleTimeInput(event,${idx},'wfoOut')"
          onblur="handleTimeBlur(event,${idx},'wfoOut')"
          placeholder="hh:mm">
      </td>
      <td class="section-div"></td>
      <td>${c.slot1In}</td>
      <td>${c.slot1Out}</td>
      <td>${c.slot1Duration}</td>
      <td class="section-div"></td>
      <td>${c.slot2In}</td>
      <td>${c.slot2Out}</td>
      <td>${c.slot2Duration}</td>
      <td class="section-div"></td>
      <td><b>${c.totalHours}</b></td>
      <td>
        <button class="btn secondary" style="padding:2px 8px;font-size:1rem" onclick="removeRow(${idx})">✕</button>
      </td>
    </tr>`;
  });
}
function addRow(){ rows.push(emptyRow()); renderTable(); }
function removeRow(i){ rows.splice(i,1); renderTable(); }
function updateCell(i, col, val){ rows[i][col] = val.trim(); renderTable(); }
function clearTable(){ if(confirm("Clear all rows?")) { rows = []; renderTable(); } }
async function pasteFromClipboard(){
  let txt = await navigator.clipboard.readText();
  let lines = txt.split(/\r?\n/).filter(line=>line.trim());
  let newRows = [];
  for (let l=0; l<lines.length; ++l){
    let cells = lines[l].split(/\t|,|;/).map(x=>x.trim());
    if (cells.length<3)
      cells = lines[l].split(/\s+/).map(x=>x.trim());
    if (cells.length>=3) {
      let [date, wfoIn, wfoOut] = cells;
      if(/^\d{3,4}$/.test(wfoIn)) wfoIn = formatHHMM(wfoIn);
      if(/^\d{3,4}$/.test(wfoOut)) wfoOut = formatHHMM(wfoOut);
      newRows.push({date, wfoIn, wfoOut});
    }
  }
  if (newRows.length) {
    rows = rows.concat(newRows);
    renderTable();
  } else {
    alert("No valid data to paste!");
  }
}
addRow();
// Make handlers available globally
window.handleTimeInput = handleTimeInput;
window.handleTimeBlur = handleTimeBlur;
window.addRow = addRow;
window.removeRow = removeRow;
window.updateCell = updateCell;
window.clearTable = clearTable;
window.pasteFromClipboard = pasteFromClipboard;
</script>
</body>
</html>
